// main global script file

// called when the game starts, before the first room is loaded
function game_start() 
{
  mouse.Visible = true;
  mouse.Mode = eModePointer;
  
  EmptyTextPrompt.Enabled = false;
}

// put anything you want to happen every game cycle in here
function repeatedly_execute() 
{
}

// put here anything you want to happen every game cycle, even when the game is blocked
function repeatedly_execute_always() 
{
}

function enable_message_gui()
{
  gMessageGui.Visible = true;
}

function disable_message_gui()
{
  gMessageGui.Visible = false;
}

function enable_review_gui()
{
  gReviewGui.Visible = true;
}

function disable_review_gui()
{
  gReviewGui.Visible = false;
}

function disable_guis()
{
  disable_message_gui();
  disable_review_gui();
}

function showModal(String text, int height)
{
  gPopupGui.Visible = true;
  
  int oldHeight = gPopupGui.Height;
  int offset = oldHeight - height;
  
  gPopupGui.Height = height;
  oModalText.Height = oModalText.Height - offset;
  oModalText.Text = text;
  modalButton.SetPosition(modalButton.X, modalButton.Y - offset);
}

function goto_first_review()
{
  Explanation.Text = firstExplanation;
  object[0].Visible = true;
}

function goto_second_review()
{
  Explanation.Text = secondExplanation;
  object[0].Visible = false;
  object[1].Visible = true;
}

function goto_third_review()
{
  Explanation.Text = thirdExplanation;
  object[1].Visible = false;
  object[2].Visible = true;
}

function goto_fourth_review()
{
  Explanation.Text = fourthExplanation;
  object[2].Visible = false;
  object[3].Visible = true;
}

function goto_send_first_picture()
{
  return;
}

function popup_review_0()
{
  showModal(modalWarning1, 60);
}

function popup_review_1()
{
  showModal(modalWarning2, 60);
}

function popup_review_2()
{
  showModal(modalWarning3, 60);
}

function approveClick(GUIControl *control, MouseButton button)
{
  if (reviewCount == 0)
  {
    goto_second_review();
    reviewCount++;
    return;
  }
  else if (reviewCount == 1)
  {
    goto_third_review();
    reviewCount++;
    return;
  }
  else if (reviewCount == 2)
  {
    showModal(tutorialCompleteMessage,  80);
    tutorialMessageVisible = true;
    return;
  }
  else if (reviewCount == 5)  //FIXME: number should be 3
  {
    //TODO: warning about image that is not acceptable
  }
  else
  {
    goto_send_first_picture();
    return;
  }
}

function rejectClick(GUIControl *control, MouseButton button)
{
  if (reviewCount == 0)
  {
    popup_review_0();
    return;
  }
  else if (reviewCount == 1)
  {
    popup_review_1();
    return;
  }
  else if (reviewCount == 2)
  {
    popup_review_2();
    return;
  }
  else if (reviewCount == 3)
  {
    //TODO: rejectable image;
  }
}

function closeModal(GUIControl *control, MouseButton button)
{
  if (tutorialMessageVisible == true)
  {
    object[2].Visible = false;
    tutorialMessageVisible = false;
    enable_message_gui();
  }
  
  if (tutorialMessage0Visible == true)
  {
    tutorialMessage0Visible = false;
    enable_review_gui();
    goto_first_review();
  }
  
  gPopupGui.Visible = false;
  oModalText.Text = "";
  
}

// called when a key is pressed. keycode holds the key's ASCII code
function on_key_press(eKeyCode keycode) 
{
  if (IsGamePaused()) keycode = 0; // game paused, so don't react to keypresses
  
  if (keycode == eKeyCtrlQ) QuitGame(1); // Ctrl-Q
  if (keycode == eKeyF9) RestartGame(); // F9
  if (keycode == eKeyF12) SaveScreenShot("scrnshot.pcx");  // F12
  if (keycode == eKeyCtrlS) Debug(0,0); // Ctrl-S, give all inventory
  if (keycode == eKeyCtrlV) Debug(1,0); // Ctrl-V, version
  if (keycode == eKeyCtrlA) Debug(2,0); // Ctrl-A, show walkable areas
  if (keycode == eKeyCtrlX) Debug(3,0); // Ctrl-X, teleport to room
  
  if (keycode == eKey1)
  {
    disable_guis();
    enable_message_gui();
  }
  
  if (keycode == eKey2)
  {
    disable_guis();
    
    reviewCount = 0;
    tutorialMessage0Visible = true;
    showModal(tutorialMessage,  100);
  }
}

function on_mouse_click(MouseButton button) // called when a mouse button is clicked. button is either LEFT or RIGHT
{
  if (IsGamePaused() == 1) // Game is paused, so do nothing (ie. don't allow mouse click)
  {
  }
  else if (button == eMouseLeft) 
  {
    Room.ProcessClick(mouse.x,mouse.y, mouse.Mode);
  }
}

function dialog_request(int param) {
}